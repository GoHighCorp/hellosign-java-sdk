var HelloSign={DEFAULT_WIDTH:912,DEFAULT_HEIGHT:900,wrapper:null,iframe:null,overlay:null,cancelButton:null,clientId:null,hasJQuery:false,isOldIE:(navigator.userAgent.match(/msie (8|7|6|5)/gi)!==null),isFF:(navigator.userAgent.match(/firefox/gi)!==null),isOpera:(navigator.userAgent.match(/opera/gi)!==null),baseUrl:"https://www.hellosign.com",EVENT_SIGNED:"signature_request_signed",EVENT_CANCELED:"signature_request_canceled",EVENT_SENT:"signature_request_sent",EVENT_ERROR:"error",init:function(a){this.clientId=a;this.hasJQuery=(window.jQuery!==undefined)},open:function(f){var a=f.redirectUrl;var r=f.messageListener;var m=f.url;if(!m){throw"No url specified"}m+=(m.indexOf("?")>0?"&":"?");if(a){m+="redirect_url="+encodeURIComponent(a)+"&"}m+="parent_url="+encodeURIComponent(document.location.href.replace(/\#.*/,""))+"&";m+="client_id="+this.clientId;var g=this.getWindowDimensions();var p=Math.min(this.DEFAULT_HEIGHT,g.height-60);var o=m.replace(/([^:]+:\/\/[^\/]+).*/,"$1");var n=parseInt((g.height-p)/2,10);var c=Math.max(0,parseInt((g.width-this.DEFAULT_WIDTH)/2,10));var q={overlay:{position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px","z-index":9997,display:"none","background-color":"#666",opacity:0.3,"-khtml-opacity":0.3,"-moz-opacity":0.3,filter:"alpha(opacity=30)","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=30)"},wrapper:{position:"absolute",top:n+"px",left:c+"px","z-index":9998},iframe:{border:"1px solid #505050","box-shadow":"0px 2px 18px 2px #666","background-color":"#FFF","z-index":9998},cancelButton:{position:"absolute",top:"-13px",right:"-13px",width:"30px",height:"30px","background-image":"url("+this.baseUrl+"/css/fancybox/fancybox.png)","background-position":"-40px 0px",cursor:"pointer","z-index":9999}};if(!this.overlay){this.overlay=document.createElement("div");this.overlay.setAttribute("id","hsEmbeddedOverlay");document.body.appendChild(this.overlay)}this.overlay.setAttribute("style","display: block;");if(!this.wrapper){this.wrapper=document.createElement("div");this.wrapper.setAttribute("id","hsEmbeddedWrapper");document.body.appendChild(this.wrapper)}if(!this.iframe){this.iframe=document.createElement("iframe");this.iframe.setAttribute("id","hsEmbeddedFrame");this.wrapper.appendChild(this.iframe)}this.iframe.setAttribute("src",m);this.iframe.setAttribute("scrolling","no");this.iframe.setAttribute("frameborder","0");this.iframe.setAttribute("width",this.DEFAULT_WIDTH);this.iframe.setAttribute("height",p);if((f.allowCancel===true||f.allowCancel===undefined)&&!this.cancelButton){this.cancelButton=document.createElement("a");this.cancelButton.setAttribute("id","hsEmbeddedCancel");this.cancelButton.setAttribute("href","#");this.cancelButton.onclick=function(e){HelloSign.close();if(r){l("Reporting cancelation");r({event:HelloSign.EVENT_CANCELED})}};this.wrapper.appendChild(this.cancelButton)}else{if(!f.allowCancel&&this.cancelButton){this.wrapper.removeChild(this.cancelButton)}}for(var d in q){var b=this[d];for(var h in q[d]){try{b.style[h]=q[d][h]}catch(j){l(j)}}}if(this.isFF||this.isOpera){var t=this.cancelButton.getAttribute("style");t+=(t?"; ":"");t+="background-image: "+q.cancelButton["background-image"]+"; ";t+="background-position: "+q.cancelButton["background-position"]+";";this.cancelButton.setAttribute("style",t)}XWM.receive(function(e){if(e.data=="close"){HelloSign.close()}else{if(e.data.indexOf("hello:")===0){var x=e.data.split(":");var s=x[1];XWM.send("helloback:"+s,m,e.source||"hsEmbeddedFrame")}else{if(r&&e.data){var u={};var w,v=e.data.split("&");for(var k in v){w=v[k].split("=");if(w.length===2){u[w[0]]=decodeURIComponent(w[1])}}r(u)}}}},o)},close:function(){if(this.iframe){var a=this;var b=function(){document.body.removeChild(a.overlay);document.body.removeChild(a.wrapper);a.wrapper.removeChild(a.iframe);a.overlay=null;a.iframe=null;a.wrapper=null};this.wrapper.removeChild(this.cancelButton);this.cancelButton=null;if(this.hasJQuery){$(this.iframe).fadeOut("500",b)}else{b()}}},reportError:function(b,a){XWM.send({event:HelloSign.EVENT_ERROR,description:b},a)},ensureParentDomain:function(d,a,g){var c="";for(var b=0;b<16;b++){c+=parseInt(Math.random()*10,10)}var f=a.split("://")[0];var e=f+"://"+d;XWM.receive(function(h){if(h.data.indexOf("helloback:")===0){var j=h.data.split(":");var i=(j[1]==c);g(i)}},e);XWM.send("hello:"+c,a)},getWindowDimensions:function(){if(this.isOldIE){return{width:document.body.clientWidth,height:document.body.clientHeight}}return{width:window.innerWidth,height:window.innerHeight}}};var XWM={cacheBust:0,lastHash:0,intervalId:0,rmCallback:null,hasPostMessage:(window.postMessage!==undefined),send:function(j,a,e){var i=XWM;if(!a){return}if(typeof j!="string"){var d=[];for(var b in j){d.push(b+"="+encodeURIComponent(j[b]))}j=d.join("&")}if(i.hasPostMessage){e=e||parent;e.postMessage(j,a.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(a){var h=new Date().getTime();var f=++i.cacheBust;var g=document.getElementById(e);if(g){g.setAttribute("src",a.replace(/#.*$/,"")+"#"+h+f+"&"+j)}else{parent.location=a.replace(/#.*$/,"")+"#"+h+f+"&"+j}}}l("Sent message "+j+" to "+a)},receive:function(d,c,b){var a=XWM;if(a.hasPostMessage){if(d){if(a.rmCallback){if(window.addEventListener){window.removeEventListener("message",a.rmCallback,false)}else{window.detachEvent("onmessage",a.rmCallback)}}a.rmCallback=function(e){if(typeof c==="string"&&e.origin!==c){return false}l("Received message "+e.data+" from "+c);d(e)}}if(window.addEventListener){window.addEventListener("message",a.rmCallback,false)}else{window.attachEvent("onmessage",a.rmCallback)}}else{if(a.intervalId){clearInterval(a.intervalId);a.intervalId=null}if(d){b=(b!==undefined?b:200);a.intervalId=setInterval(function(){var g=document.location.hash;var e=/^#?\d+&/;if(g!==a.lastHash&&e.test(g)){a.lastHash=g;var f=g.replace(e,"");d({data:f});l("Received message "+f+" from "+c)}},b)}}}};function l(a){if(!document.location.href.match(/(staging|my)\.hello(fax|sign)\.com/gi)){return}if(window.console&&console.log){console.log(a)}};